---
<% if @system.config['logo'] -%>
title: |
    ![](<%= @system.config['logo']['path'] -%>){width=<%= @system.config['logo']['width'] %>}

    <%= @system.config['name'] %>
<% else %>
title: "<%= @system.config['name'] -%>"
<% end %>

subtitle: "System Security Plan"

author:
<% @system.config['maintainers'].each do |maintainer| %>
    - <%= maintainer -%>
<% end %>

absract: |
    <%= @system.config['metadata']['abstract'] rescue 'None' %>

description: |
    <%= @system.config['metadata']['description'] rescue 'None' %>

fontsize: 11pt
mainfont: NotoSans
#monofont: NotoSansMono-ExtraCondensedLight
monofont: NotoSansMono-ExtraCondensed
mainfontoptions:
    - Numbers=Lowercase
    - Numbers=Proportional
    - UprightFont=*
    - ItalicFont=*-Italic
    - BoldFont=*-Bold
    - BoldItalicFont=*-BoldItalic

lof: true
lot: true
colorlinks: true
linkcolor: black  # internal links (e.g., lof and lot)
urlcolor: blue

documentclass: report
classoption:
    - onecolumn
    - oneside
    - portrait

pagestyle: headings
papersize: letter
geometry:
    - top=2cm
    - left=2cm
    - right=2cm
    - bottom=2cm

header-includes:
    - |
        ```{=latex}
        % https://github.com/jgm/pandoc/wiki/Pandoc-Tricks#left-aligning-tables-in-latex
        \usepackage[margins=raggedright]{floatrow}
        ```
    - |
        ```{=latex}
        % https://github.com/jgm/pandoc/wiki/Pandoc-Tricks#definition-list-terms-on-their-own-line-in-latex
        % "Clone" the original \item command
        \let\originalitem\item

        % Redefine the \item command using the "clone"
        \makeatletter
        \renewcommand{\item}[1][\@nil]{%
            \def\tmp{#1}%
            \ifx\tmp\@nnil\originalitem\else\originalitem[#1]\hfill\par\fi}
        \makeatother
        ```
---

# <%= @system.config['name'] %>

## Overview

<%= @system.config['overview'] %>

## Standards

This System Security Plan (SSP) addresses these standards:

<% @system.standards.each do |s| -%>
- <%= s['name'] %>
<% end %>

The full copy of each standard is included in the appendix.


## Components

<% @system.components.each do |c| %>
### <%= c['name'] %>

<%= c['description'] %>

<% if c['attestations'].empty? %>
_The organization has not yet documented attestations for this component_.
<% else %>
The organization offers the following attestations for this component.
<% end %>

<% c['attestations'].each do |a| %>
####  <%= a['summary'] %>

Status: <%= a['status'] %>

Date verified: <%= a['date_verified'] if a['date_verified'] %>

Satisfies:

<% a['satisfies'].each do |cid| -%>
- <%= cid['standard_key'] %> control <%= cid['control_key'] %>
<% end -%>

<%= a['narrative'] %>

<% end %>
<% end %>


# Appendix: Standards

<% @system.standards.each do |s| %>
## <%=s['name'] %>

<% if s['families'] and !s['families'].empty? %>
### Families

<%=s['name']-%> categorizes controls into logical groups called families.

| Family abbreviation        | Family name          |
| -------------------------- | -------------------- |
<% s['families'].each do |family| -%>
| <%=family['family_key']-%> | <%=family['name']-%> |
<% end -%>

  : Control families for <%=s['name']%>

<% end %>

### Controls

<% s['controls'].each do |c| %>
#### Control <%= c['control_key'] -%>: <%= c['name'] %>

<%= c['description'] %>

<% end %>
<% end %>
